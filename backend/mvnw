#!/bin/sh
# Maven Wrapper script

set -e

# Determine the script directory
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
WRAPPER_JAR="$SCRIPT_DIR/.mvn/wrapper/maven-wrapper.jar"
WRAPPER_PROPERTIES="$SCRIPT_DIR/.mvn/wrapper/maven-wrapper.properties"
MAVEN_HOME="$HOME/.m2/wrapper/dists"

# Read properties
if [ -f "$WRAPPER_PROPERTIES" ]; then
    DIST_URL=$(grep "distributionUrl" "$WRAPPER_PROPERTIES" | cut -d'=' -f2-)
    WRAPPER_URL=$(grep "wrapperUrl" "$WRAPPER_PROPERTIES" | cut -d'=' -f2-)
fi

DIST_URL=${DIST_URL:-"https://repo.maven.apache.org/maven2/org/apache/maven/apache-maven/3.9.6/apache-maven-3.9.6-bin.zip"}

# Extract version from URL
MAVEN_VERSION=$(echo "$DIST_URL" | sed 's/.*apache-maven-\([0-9.]*\).*/\1/')
MAVEN_DIST_DIR="$MAVEN_HOME/apache-maven-$MAVEN_VERSION"

# Download and extract Maven if not present
if [ ! -d "$MAVEN_DIST_DIR" ]; then
    echo "Downloading Maven $MAVEN_VERSION..."
    mkdir -p "$MAVEN_HOME"
    TEMP_FILE=$(mktemp)

    if command -v curl > /dev/null; then
        curl -fsSL "$DIST_URL" -o "$TEMP_FILE"
    elif command -v wget > /dev/null; then
        wget -q "$DIST_URL" -O "$TEMP_FILE"
    else
        echo "Error: curl or wget required"
        exit 1
    fi

    echo "Extracting Maven..."
    unzip -q "$TEMP_FILE" -d "$MAVEN_HOME"
    rm "$TEMP_FILE"
fi

# Run Maven
exec "$MAVEN_DIST_DIR/bin/mvn" "$@"
